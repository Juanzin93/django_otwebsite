{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}{% endblock %}</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'assets/css/base.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/layout.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-menu.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-right.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/slider.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/responsive.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-gallery.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-highscores.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-characters.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-serverinfo.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-online.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-news.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-inventory.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-account.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-bazaar.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-store.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-guild.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-last_kills.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/components-team.css' %}">


</head>
<body>
  <div class="bg">
    <div class="bg__glow bg__glow--left"></div>
    <div class="bg__glow bg__glow--right"></div>
  </div>
  
  <div class="site">
    <header class="banner">
      <div class="logo">RETRO <span>WAR</span></div>
      <div class="ticker">
        <div class="ticker__label">News Ticker</div>
        <div class="ticker__track">
          <span class="dot"></span>
          <div class="ticker__marquee">
            <span>Welcome to Retrowar OT!</span>
          </div>
        </div>
      </div>
      <!-- Countdown (style this however you want) -->
<div id="countdown" class="countdown">
  <span class="cd-part">Starts In </span>
  <span class="cd-part"><span id="cd-days">0</span>d</span>
  <span class="cd-part"><span id="cd-hours">00</span>h</span>
  <span class="cd-part"><span id="cd-mins">00</span>m</span>
  <span class="cd-part"><span id="cd-secs">00</span>s</span>
</div>
<div id="countdown-finished" class="hidden">ðŸŽ‰ Server is Online!</div>

<style>
  .countdown { display:flex; gap:.5rem; font-weight:600; font-variant-numeric: tabular-nums; }
  .cd-part { padding:.25rem .5rem; border-radius:.5rem; background:#11111110 }
  .hidden { display:none; }
</style>
    </header>

    <div class="columns">
      <aside class="col col--left">
        <section class="panel acc">
          <h3 class="panel__title">MENU</h3>

          <div class="acc__item is-open">
            <button class="acc__header" aria-expanded="true">
              <span>News</span>
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"/></svg>
            </button>
            <div class="acc__body">
              <ul class="menu">
                <li><a href="{% url 'news_list' %}">Home</a></li>
                <li><a href="{% url 'news_archive' %}">News Archive</a></li>
                <!--<li><a href="#">Changelog</a></li>-->
                <!--<li><a href="#">Downloads</a></li>-->
                <li><a href="{% url 'rules' %}">Rules</a></li>
                <!--<li><a href="#">FAQ</a></li>-->
              </ul>
            </div>
          </div>

          <div class="acc__item">
            <button class="acc__header" aria-expanded="false">
              <span>Account</span>
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"/></svg>
            </button>
            <div class="acc__body" hidden>
              <ul class="menu">
                {% if user.is_authenticated %}
                    <li><a href="{% url 'account_manage' %}">Manage Account</a></li>
                    <li><a href="{% url 'password_change' %}">Change Password</a></li>
                    <li><a href="{% url 'logout' %}">Logout</a></li>
                {% else %}
                    <li><a href="{% url 'signup' %}">Create Account</a></li>
                {% endif %}
                <li><a href="{% url 'password_reset' %}">Lost Account</a></li>
                <!--<li><a href="{% url 'search_character' %}">Forum</a></li>-->
              </ul>
            </div>
          </div>

          <div class="acc__item">
            <button class="acc__header" aria-expanded="false">
              <span>Community</span>
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"/></svg>
            </button>
            <div class="acc__body" hidden>
              <ul class="menu">
                <li><a href="{% url 'search_character' %}">Search Character</a></li>
                <li><a href="{% url 'online_list' %}">Online</a></li>
                <li><a href="{% url 'highscores' %}">Highscores</a></li>
                <li><a href="{% url 'last_kills' %}">Last Kills</a></li>
                <li><a href="{% url 'houses_list' %}">Houses</a></li>
                <!--<li><a href="#">Bug Tracker</a></li>-->
                <li><a href="{% url 'guild_list' %}">Guilds</a></li>
                <li><a href="{% url 'bans_list' %}">Bans</a></li>
                <!--<li><a href="#">Forum</a></li>-->
                <li><a href="{% url 'team' %}">Team</a></li>
              </ul>
            </div>
          </div>

          <div class="acc__item">
            <button class="acc__header" aria-expanded="false">
              <span>Library</span>
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"/></svg>
            </button>
            <div class="acc__body" hidden>
              <ul class="menu">
                <li><a href="{% url 'ability_orbs' %}">Ability Orbs</a></li>
                <li><a href="{% url 'refine' %}">Refine System</a></li>
                <li><a href="{% url 'bestiary' %}">Bestiary</a></li>
                <li><a href="{% url 'commands' %}">Commands</a></li>
                <li><a href="{% url 'server_info' %}">Server Info</a></li>
                <li><a href="{% url 'gallery' %}">Gallery</a></li>
                <!--<li><a href="#">Experience Table</a></li>-->
              </ul>
            </div>
          </div>
          {% if SHOP_ENABLED %}
          <div class="acc__item">
            <button class="acc__header" aria-expanded="false">
              <span>Shop</span>
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"/></svg>
            </button>
            <div class="acc__body" hidden>
              <ul class="menu">
                <li><a href="{% url 'donate' %}">Donate</a></li>
                <!--<li><a href="#">Shop Offers</a></li>-->
                <li><a href="{% url 'bazaar_list' %}">Char Bazaar</a></li>
              </ul>
            </div>
          </div>
            {% endif %}
        </section>
      </aside>

      
      {% block content %}{% endblock %}

      <aside class="col col--right">
        <section class="panel dl">
          <a class="btn btn--dl" href="https://mega.nz/file/JX5QETbI#f_ms5_1DNcoGmvfmoAm8yIXeLJwqOlNkIyVnGdcVGcg">Download Client</a>
          <small>Download latest client</small>
        </section>
        <br>

        {% if QUICKLOGIN_SHOWBOX_ENABLED %}
        <section class="panel">
        <h3 class="panel__title">QUICK LOGIN</h3>

        {% if user.is_authenticated %}
            <p class="small">Welcome, <b>{{ user.username }}</b></p>
            <a class="btn btn--blue" href="{% url 'account_manage' %}">Manage Account</a>
            <a class="btn btn--blue" href="{% url 'password_change' %}">Change Password</a>
            <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button class="btn btn--gold" type="submit">Logout</button>
            </form>
        {% else %}
            <form class="login" method="post" action="/accounts/login/">
            {% csrf_token %}
            <label for="id_username">Account number</label>
            <input id="id_username" name="username" type="text" required autocomplete="username">

            <label for="id_password">Password</label>
            <input id="id_password" name="password" type="password" required autocomplete="current-password">

            <div class="login__actions">
                <button class="btn btn--blue" type="submit">Log in</button>
                <a class="btn btn--gold" href="{% url 'signup' %}">Register</a>
            </div>

            <small><a class="link" href="{% url 'password_reset' %}">Lost Account?</a></small>
            </form>
        {% endif %}
        </section>
        {% endif %}
        <br>
        {% if GALLERY_SHOWBOX_ENABLED %}
        <section class="panel">
            <h3 class="panel__title">GALLERY</h3>
            <div class="gallery slider" style="--per-view:1" data-autoplay="true" data-interval="4000">
                <div class="slider__viewport">
                <div class="slider__track">
                {% for photo in gallery %}
                    <a class="thumb" style="background-image:url('{% static photo %}')" aria-label="Screenshot {{ forloop.counter }}"></a>
                {% endfor %}
                </div>
                </div>
                <button class="slider__btn slider__btn--prev" aria-label="Previous">â€¹</button>
                <button class="slider__btn slider__btn--next" aria-label="Next">â€º</button>
                <div class="slider__dots"></div>
            </div>
        </section>
        <br>
        {% endif %}
        {% if SERVERINFO_SHOWBOX_ENABLED %}
        <section class="panel" id="server-status-box" data-endpoint="{% url 'server_status' %}">
          <h3 class="panel__title">SERVER INFO</h3>
          <ul class="kv">
            <li><span>Status:</span>  <b class="js-status">â€”</b></li>
            <li><span>Players:</span> <b class="js-players">0</b></li>
            <li><span>Record:</span>  <b class="js-peak">0</b></li>
          </ul>
          <a class="link" href="{% url 'server_info' %}">Â» Server Information</a>
        </section>
        <br>
        {% endif %}
        {% if CHARMARKET_SHOWBOX_ENABLED %}
        <section class="panel">
          <h3 class="panel__title">CHAR MARKET</h3>
          <p class="muted">No characters for sale.</p>
        </section>
        <br>
        {% endif %}

        {% if POWERGAMERS_SHOWBOX_ENABLED %}
        <section class="panel">
          <h3 class="panel__title">POWER GAMERS</h3>
          <ul class="kv">
            <li><span>Developer</span> <b>0</b></li>
            <li><span>Rook Sample</span> <b>0</b></li>
            <li><span>Dev</span> <b>0</b></li>
            <li><span>Hazel Hickory</span> <b>0</b></li>
          </ul>
        </section>
        <br>
        {% endif %}
        
        {% if ONLINERANKING_SHOWBOX_ENABLED %}
        <section class="panel">
          <h3 class="panel__title">MOST ONLINE</h3>
          <ul class="kv">
            <li><span>Developer</span> <b>0</b></li>
            <li><span>Rook Sample</span> <b>0</b></li>
            <li><span>Dev</span> <b>0</b></li>
            <li><span>Hazel Hickory</span> <b>0</b></li>
          </ul>
        </section>
        <br>
        {% endif %}
        <section class="panel">
          <h3 class="panel__title">SOCIAL MEDIA</h3>

          <!-- Self-contained styles just for this widget -->
          <style>
            .contact-icons-mini {
              display: flex;
              justify-content: center;
              align-items: center;
              gap: 14px;
              margin-top: 8px;
            }
            .contact-icons-mini a {
              display: inline-flex;
              justify-content: center;
              align-items: center;
              width: 72px;   /* overall button size */
              height: 72px;
              border-radius: 8px;
              text-decoration: none;
            }
            .contact-icons-mini img {
              width: 44px;   /* icon size */
              height: 44px;
              display: block;
            }
            /* Optional brand backgrounds (remove if you want transparent) */
            .contact-icons-mini .discord { background: #5865F2; }
            .contact-icons-mini .whatsapp { background: #25D366; }

            /* Subtle hover */
            .contact-icons-mini a:hover { transform: translateY(-1px); }
          </style>

          <div class="contact-icons-mini">
            <a class="discord" href="https://discord.gg/BfBhFhek6e" target="_blank" rel="noopener" title="Join us on Discord">
              <img src="https://cdn.jsdelivr.net/npm/simple-icons@9/icons/discord.svg" alt="Discord">
            </a>
            <a class="whatsapp" href="https://chat.whatsapp.com/IdOa3EULlU5CuBh2hBagag?mode=ems_copy_c" target="_blank" rel="noopener" title="Message us on WhatsApp">
              <img src="https://cdn.jsdelivr.net/npm/simple-icons@9/icons/whatsapp.svg" alt="WhatsApp">
            </a>
          </div>
        </section>
        <br>
      </aside>
    </div>
    <footer class="footer"></footer>
  </div>

  <script src="{% static 'assets/js/accordion.js' %}" defer></script>
  <script src="{% static 'assets/js/slider.js' %}" defer></script>
  <script src="{% static 'assets/js/server_status.js' %}" defer></script>
  <script src="{% static 'assets/js/navspan.js' %}" defer></script>
  <script src="{% static 'assets/js/equip_inline.js' %}" defer></script>
  <script src="{% static 'assets/js/bazaar-list.js' %}" defer></script>
<script>
(function () {
  // --- Choose ONE of these targets ---

  // (A) Hardcode a target date/time (ISO 8601 is safest)
  // const targetIso = "2025-11-01T00:00:00Z"; // UTC midnight
  // const target = new Date(targetIso).getTime();

  // (B) From Django context as ISO string (recommended)
  //   In your view: context["launch_iso"] = "2025-11-01T00:00:00Z"
  const target = new Date("{{ launch_iso|default:'2025-10-17T18:00:00-04:00' }}").getTime();

  // (Optional) pass server "now" to reduce client clock drift:
  // In your view: context["server_now_iso"] = timezone.now().isoformat()
  const serverNowIso = "{{ server_now_iso|default:'' }}";
  const clientNow = Date.now();
  const startNow = serverNowIso ? new Date(serverNowIso).getTime() : clientNow;
  let drift = clientNow - startNow; // ms: positive if client is ahead of server

  // --- Elements ---
  const elDays = document.getElementById("cd-days");
  const elHours = document.getElementById("cd-hours");
  const elMins = document.getElementById("cd-mins");
  const elSecs = document.getElementById("cd-secs");
  const wrap = document.getElementById("countdown");
  const done = document.getElementById("countdown-finished");

  function pad(n) { return n < 10 ? "0" + n : "" + n; }

  function tick() {
    const now = Date.now() - drift;
    let diff = target - now;

    if (diff <= 0) {
      // Hit zero: swap UI and stop.
      elDays.textContent = "0";
      elHours.textContent = "00";
      elMins.textContent = "00";
      elSecs.textContent = "00";
      if (wrap) wrap.classList.add("hidden");
      if (done) done.classList.remove("hidden");

      // Optional: do something (redirect, enable button, etc.)
      // window.location.reload();
      clearInterval(timer);
      return;
    }

    const sec = Math.floor(diff / 1000);
    const days  = Math.floor(sec / 86400);
    const hours = Math.floor((sec % 86400) / 3600);
    const mins  = Math.floor((sec % 3600) / 60);
    const secs  = sec % 60;

    elDays.textContent  = days;
    elHours.textContent = pad(hours);
    elMins.textContent  = pad(mins);
    elSecs.textContent  = pad(secs);
  }

  // Initial paint + 1s interval
  tick();
  const timer = setInterval(tick, 1000);
})();
</script>

</body>
</html>
